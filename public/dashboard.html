<!DOCTYPE html>
<html lang="pt-BR" x-data="dashboard()" x-init="checkAuth(); fetchData()">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard - OddGuru PRO</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <style>
    .gradient-bg { background: linear-gradient(135deg, #0f0f1e, #1a1a2e); }
    .card-hover:hover { transform: translateY(-4px); box-shadow: 0 20px 25px -5px rgba(139, 92, 246, 0.3); }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen gradient-bg">

  <!-- HEADER -->
  <header class="border-b border-gray-800 backdrop-blur-sm bg-black/60 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
      <div class="flex items-center space-x-3">
        <div class="w-10 h-10 bg-gradient-to-r from-purple-600 to-pink-600 rounded-full"></div>
        <h1 class="text-2xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
          OddGuru PRO
        </h1>
      </div>
      <div class="flex items-center space-x-6 text-sm">
        <span x-text="`ROI: ${stats.roi}`" class="font-bold text-green-400"></span>
        <span x-text="`Lucro: R$${stats.profit}`" class="font-bold text-green-400"></span>
        <button @click="logout()" class="text-gray-400 hover:text-white">Sair</button>
      </div>
    </div>
  </header>

  <!-- TOGGLE VIEW -->
  <div class="max-w-7xl mx-auto px-4 py-6 flex justify-between items-center">
    <div class="flex gap-2">
      <button @click="filter = 'all'" :class="filter === 'all' ? 'bg-purple-600' : 'bg-gray-700'" class="px-4 py-2 rounded-lg text-sm">Todos</button>
      <button @click="filter = '1X2'" :class="filter === '1X2' ? 'bg-purple-600' : 'bg-gray-700'" class="px-4 py-2 rounded-lg text-sm">1X2</button>
      <button @click="filter = 'gols'" :class="filter === 'gols' ? 'bg-purple-600' : 'bg-gray-700'" class="px-4 py-2 rounded-lg text-sm">Gols</button>
      <button @click="filter = 'cartoes'" :class="filter === 'cartoes' ? 'bg-purple-600' : 'bg-gray-700'" class="px-4 py-2 rounded-lg text-sm">Cartões</button>
    </div>
    <div class="flex gap-2">
      <button @click="view = 'cards'" :class="view === 'cards' ? 'bg-purple-600' : 'bg-gray-700'" class="px-3 py-1 rounded text-xs">Cards</button>
      <button @click="view = 'list'" :class="view === 'list' ? 'bg-purple-600' : 'bg-gray-700'" class="px-3 py-1 rounded text-xs">Lista</button>
    </div>
  </div>

  <!-- CARDS VIEW -->
  <div x-show="view === 'cards'" class="max-w-7xl mx-auto px-4 grid gap-6 md:grid-cols-2 lg:grid-cols-3">
    <template x-for="bet in filteredBets()" x-key="bet.id">
      <div class="bg-gray-800/60 backdrop-blur rounded-xl p-6 card-hover border border-gray-700">
        <div class="flex justify-between items-start mb-3">
          <h3 class="font-bold text-lg" x-text="bet.match"></h3>
          <span class="text-xs px-2 py-1 rounded-full bg-yellow-600" x-text="'Pendente'"></span>
        </div>
        <div class="space-y-2 text-sm">
          <p><span class="text-gray-400">Mercado:</span> <span x-text="bet.market"></span></p>
          <p><span class="text-gray-400">Odd:</span> <span class="text-green-400 font-bold" x-text="bet.odd"></span></p>
          <p><span class="text-gray-400">Edge:</span> <span class="text-purple-400" x-text="`+${(bet.edge*100).toFixed(1)}%`"></span></p>
        </div>
        <div class="mt-4 p-3 bg-gray-900/50 rounded-lg text-xs text-gray-300">
          <p class="font-medium text-purple-400 mb-1">IA:</p>
          <p x-text="bet.why"></p>
        </div>
      </div>
    </template>
  </div>

  <!-- LIST VIEW -->
  <table x-show="view === 'list'" class="max-w-7xl mx-auto mx-4 text-sm text-left text-gray-300">
    <thead class="text-xs uppercase bg-gray-800">
      <tr>
        <th class="px-4 py-3">Jogo</th>
        <th class="px-4 py-3">Mercado</th>
        <th class="px-4 py-3">Odd</th>
        <th class="px-4 py-3">Edge</th>
        <th class="px-4 py-3">IA</th>
      </tr>
    </thead>
    <tbody>
      <template x-for="bet in filteredBets()" x-key="bet.id">
        <tr class="bg-gray-800/50 border-b border-gray-700 hover:bg-gray-700/50">
          <td class="px-4 py-3" x-text="bet.match"></td>
          <td class="px-4 py-3" x-text="bet.market + ' → ' + bet.selection"></td>
          <td class="px-4 py-3 text-green-400" x-text="bet.odd"></td>
          <td class="px-4 py-3 text-purple-400" x-text="`+${(bet.edge*100).toFixed(1)}%`"></td>
          <td class="px-4 py-3 text-xs" x-text="bet.why"></td>
        </tr>
      </template>
    </tbody>
  </table>

  <script>
    function dashboard() {
      return {
        bets: [], stats: { roi: '0%', profit: '0', wins: 0, total: 0 },
        filter: 'all', view: 'cards',

        checkAuth() {
          if (!localStorage.getItem('token')) window.location.href = '/login.html';
        },
        logout() { localStorage.removeItem('token'); window.location.href = '/'; },

        async fetchData() {
          const [active, history] = await Promise.all([
            fetch('/api/active-bets').then(r => r.json()),
            fetch('/api/history').then(r => r.json())
          ]);
          this.bets = active.active_bets.map(b => ({ ...b, result: null }));
          this.stats = { roi: history.roi, profit: history.profit };
        },

        filteredBets() {
          let f = this.bets;
          if (this.filter !== 'all') f = f.filter(b => b.market === this.filter);
          return f.sort((a, b) => b.edge - a.edge);
        }
      }
    }
  </script>
</body>
</html>
