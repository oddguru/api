<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>OddGuru PRO</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .gradient-bg { background: linear-gradient(135deg, #1a1a2e, #16213e); }
    .card-hover { transition: all 0.3s; }
    .card-hover:hover { transform: translateY(-4px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3); }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen gradient-bg" x-data="oddGuru()" x-init="fetchBets()">

  <!-- HEADER -->
  <header class="border-b border-gray-800 backdrop-blur-sm bg-black/50 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
      <div class="flex items-center space-x-3">
        <div class="w-10 h-10 bg-gradient-to-r from-purple-600 to-pink-600 rounded-full"></div>
        <h1 class="text-2xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
          OddGuru PRO
        </h1>
      </div>
      <div class="flex items-center space-x-6 text-sm">
        <span x-text="`ROI: ${stats.roi}`" class="font-semibold text-green-400"></span>
        <span x-text="`Lucro: R$${stats.profit}`" class="font-semibold text-green-400"></span>
        <span x-text="`${stats.wins}/${stats.total} (${stats.winRate}%)`" class="font-medium"></span>
      </div>
    </div>
  </header>

  <!-- FILTROS -->
  <div class="max-w-7xl mx-auto px-4 py-6">
    <div class="flex flex-wrap gap-3">
      <button @click="filter = 'all'" :class="filter === 'all' ? 'bg-purple-600' : 'bg-gray-700'" 
              class="px-4 py-2 rounded-lg font-medium transition">Todos</button>
      <button @click="filter = '1X2'" :class="filter === '1X2' ? 'bg-purple-600' : 'bg-gray-700'" 
              class="px-4 py-2 rounded-lg font-medium transition">1X2</button>
      <button @click="filter = 'gols'" :class="filter === 'gols' ? 'bg-purple-600' : 'bg-gray-700'" 
              class="px-4 py-2 rounded-lg font-medium transition">Gols</button>
      <button @click="filter = 'cartoes'" :class="filter === 'cartoes' ? 'bg-purple-600' : 'bg-gray-700'" 
              class="px-4 py-2 rounded-lg font-medium transition">Cartões</button>
    </div>
  </div>

  <!-- BETS ATIVAS -->
  <div class="max-w-7xl mx-auto px-4 pb-12">
    <h2 class="text-xl font-bold mb-6 flex items-center">
      <span class="w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"></span>
      Value Bets Ativas
    </h2>

    <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
      <template x-for="bet in filteredBets()" x-key="bet.id">
        <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 card-hover border border-gray-700">
          <div class="flex justify-between items-start mb-3">
            <h3 class="font-bold text-lg" x-text="bet.match"></h3>
            <span class="text-xs px-2 py-1 rounded-full"
                  :class="bet.result === 'win' ? 'bg-green-600' : bet.result === 'loss' ? 'bg-red-600' : 'bg-yellow-600'"
                  x-text="bet.result ? (bet.result === 'win' ? 'WIN' : 'LOSS') : 'Pendente'"></span>
          </div>

          <div class="space-y-2 text-sm">
            <p><span class="text-gray-400">Mercado:</span> <span x-text="bet.market"></span></p>
            <p><span class="text-gray-400">Seleção:</span> <strong x-text="bet.selection"></strong></p>
            <p><span class="text-gray-400">Odd:</span> <span class="text-green-400 font-bold" x-text="bet.odd"></span></p>
            <p><span class="text-gray-400">Edge:</span> <span class="text-purple-400" x-text="`+${(bet.edge * 100).toFixed(1)}%`"></span></p>
          </div>

          <div class="mt-4 p-3 bg-gray-900/50 rounded-lg text-xs text-gray-300">
            <p class="font-medium text-purple-400 mb-1">Por que apostar?</p>
            <p x-text="bet.why"></p>
          </div>
        </div>
      </template>
    </div>

    <div x-show="filteredBets().length === 0" class="text-center py-12 text-gray-400">
      Nenhuma value bet ativa no momento.
    </div>
  </div>

  <!-- SCRIPT -->
  <script>
    function oddGuru() {
      return {
        bets: [],
        stats: { roi: '0.0%', profit: '0.00', wins: 0, total: 0, winRate: '0.0' },
        filter: 'all',

        async fetchBets() {
          try {
            const [active, history] = await Promise.all([
              fetch('/api/active-bets').then(r => r.json()),
              fetch('/api/history').then(r => r.json())
            ]);

            this.bets = [
              ...active.active_bets.map(b => ({ ...b, result: null })),
              ...history.history.map(b => ({ ...b, result: b.result }))
            ];

            this.stats = {
              roi: history.roi,
              profit: history.profit,
              wins: history.wins,
              total: history.total_bets,
              winRate: history.total_bets > 0 ? ((history.wins / history.total_bets) * 100).toFixed(1) : '0.0'
            };
          } catch (e) {
            console.error(e);
          }
        },

        filteredBets() {
          let filtered = this.bets.filter(b => !b.result); // Só ativas
          if (this.filter !== 'all') {
            filtered = filtered.filter(b => b.market === this.filter);
          }
          return filtered.sort((a, b) => new Date(b.bet_date) - new Date(a.bet_date));
        }
      }
    }
  </script>
</body>
</html>
